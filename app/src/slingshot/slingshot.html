<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>슬링샷</title>
</head>
<style>

    html, body { width:100%; height:100%;
        overflow:  hidden;} /* just to be sure these are full screen*/

    #canvas{
        display: block;
    }
</style>
<body>
<canvas id="canvas" width="1000" height="500">
</canvas>
<br/>
<!--<form action="" id="f" onSubmit="return fire();">
    속도, 각도를 지정하고 대포를 발사<br/>
    대포에서 발사되는 <속도input id="vo" name="vo" value="10" type="number" min="100" max="100"></속도input><br/>
    각도<각도input id="ang" name="ang" value="0" type="number" min="0" max="80"></각도input><br/>
    <input type="submit" value="발사" />
</form>
-->
<script src="../../dist/js/sling.js"> </script>
<script src="../../dist/js/makeGame.js"> </script>
<script>
    "use strict";
   window.onload=function(){
        let movePossible=false;
        let canvas=document.getElementById("canvas");
        let ctx=canvas.getContext("2d");
        let horvelocity=0;
        let verticalvelBefore=0;
        let verticalvelAfter=0;
        let moveBallInterval;
        //시작 위치
        let startX=100;
        let startY=240;

//       ctx.canvas.width  = window.innerWidth-10;
//       ctx.canvas.height = 500;
//       //게임 오브젝트 생성 및 그리기
       var gameComponent=makeGameComponet(startX,startY, ctx );
       gameComponent.drawAll();

        //addEventListner
       canvas.addEventListener("mousedown", findball, false);
       canvas.addEventListener("mousemove", moveit, false);
       canvas.addEventListener("mouseup", finish, false);

       function findball(e){
            if(gameComponent.isInShapeArea(getClientX(e), getClientY(e), componet.BALL)){
                movePossible=true;
                gameComponent.drawAll();
            };

       }

       function moveit(e){
           let mX=getClientX(e);
           let mY=getClientY(e);
           if(movePossible){
               gameComponent.resetPosition(mX, mY, componet.BALL);
               gameComponent.resetPosition(mX, mY, componet.SLING);
               gameComponent.drawAll();
           }
       }

       //어렵;;
       function finish(e){
           if(movePossible){
               let outofcannon=gameComponent.getOut0fCannon();
               let angleradians=gameComponent.getAngleRadians();
               horvelocity=outofcannon*Math.cos(angleradians);
               verticalvelBefore=-outofcannon*Math.sin(angleradians);
               moveBallInterval=setInterval(change, 100);
               movePossible=false;
           }
       }

       function change(){
           let dx=horvelocity;
           verticalvelAfter=verticalvelBefore+2;
           let dy=(verticalvelBefore+verticalvelAfter)*0.5;
           verticalvelBefore=verticalvelAfter;

           gameComponent.moveBall(dx, dy, moveBallInterval, canvas);
           gameComponent.resetPosition(startX, startY, componet.SLING);
       }

       function getClientX(e){
           return e.clientX-canvas.offsetLeft;
       }
       function getClientY(e){
           return e.clientY-canvas.offsetTop;
       }

   }

</script>
</body>
</html>